{% extends "core/base.html" %}
{% block title %}Há»“ sÆ¡ cÃ¡ nhÃ¢n{% endblock %}

{% block content %}
<head>
    <meta charset="UTF-8">
    <title>Profile</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/profile.css' %}">
</head>

<section class="profile-wrapper">
    <section class="profile-card">
        <h2>ğŸ‘¤ ThÃ´ng tin cÃ¡ nhÃ¢n</h2>

<section class="profile-card">
    <div class="profile-info-grid">
        <p><b>TÃªn Ä‘Äƒng nháº­p:</b> {{ user.username }}</p>
        <p><b>Email:</b> {{ user.email }}</p>

        {% if user.birth_day %}
            <p><b>NgÃ y sinh:</b> {{ user.birth_day|date:"d/m/Y" }}</p>
        {% endif %}

        {% if user.declared_level %}
            <p>
                <b>TrÃ¬nh Ä‘á»™ tá»± Ä‘Ã¡nh giÃ¡:</b>
                <span class="level-badge">{{ user.get_declared_level_display }}</span>
            </p>
        {% endif %}

        {% if user.goals %}
            <p><b>Má»¥c tiÃªu há»c táº­p:</b> {{ user.get_goals_display }}</p>
        {% endif %}

        {% if user.education %}
            <p><b>Há»c váº¥n:</b> {{ user.get_education_display }}</p>
        {% endif %}

        {% if user.profession %}
            <p><b>Nghá» nghiá»‡p:</b> {{ user.get_profession_display }}</p>
        {% endif %}

        {% if user.referred_frequency %}
            <p><b>Táº§n suáº¥t há»c mong muá»‘n:</b> {{ user.get_referred_frequency_display }}</p>
        {% endif %}

        {% if user.motivation_level %}
            <p><b>Äá»™ng lá»±c há»c táº­p:</b> {{ user.motivation_level }}/10</p>
        {% endif %}

        {% if user.hobby %}
            <p><b>Sá»Ÿ thÃ­ch:</b> {{ user.get_hobby_display }}</p>
        {% endif %}
    </div>
</section>
</section class="profile-card">
    <h2>ğŸ“Š Thá»‘ng kÃª ká»¹ nÄƒng</h2>

    <div class="chart-slider fade-up">
        <div class="chart-card">
            <h3>ğŸ¯ Äá»™ chÃ­nh xÃ¡c theo ká»¹ nÄƒng</h3>
            <canvas id="skillChart"></canvas>
        </div>

        <div class="chart-card">
            <h3>ğŸ“š Tá»· lá»‡ Listening vs Reading</h3>
            <canvas id="sectionChart"></canvas>
        </div>
    </div>
</section>

<script>
    const observer = new IntersectionObserver(entries => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('show');
            }
        });
    }, {
        threshold: 0.3
    });

    document.querySelectorAll('.fade-up').forEach(el => {
        observer.observe(el);
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const skillData = {{ skill_accuracy|default:"[]"|safe }};
    const sectionData = {{ section_accuracy|default:"[]"|safe }};

    if (skillData.length > 0) {
        new Chart(document.getElementById('skillChart'), {
            type: 'bar',
            data: {
                labels: skillData.map(i => i.skill),
                datasets: [{
                    label: 'Accuracy (%)',
                    data: skillData.map(i => i.avg_accuracy * 100),
                    backgroundColor: '#2563eb',
                    borderRadius: 6,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                animation: {
                    duration: 1200,
                    easing: 'easeOutQuart'
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100
                    }
                }
            }
        });
    }

    if (sectionData.length > 0) {
        new Chart(document.getElementById('sectionChart'), {
            type: 'pie',
            data: {
                labels: sectionData.map(i => i.section),
                datasets: [{
                    data: sectionData.map(i => i.avg_accuracy * 100),
                }]
            }
        });
    }
</script>
{% endblock %}